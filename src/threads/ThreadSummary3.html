## 실무에서 병렬 스트림과 CompletableFuture 사용 시 주의점

### 병렬 스트림(parallelStream)의 흔한 실수

- 병렬 스트림을 I/O 대기 작업에 사용하는 것은 매우 위험하다.
- 병렬 스트림은 Fork/Join 공용 풀을 기반으로 하며, CPU 바운드 작업에 적합하도록 설계되었다.
- I/O 작업에 사용할 경우, 공용 풀의 스레드가 모두 대기 상태에 빠져 병목 현상이 발생할 수 있다.
- 이로 인해 전체 요청이 밀리고, 심각한 장애로 이어질 수 있다.

---

### CompletableFuture 사용 시 반드시 알아야 할 점

- 복잡한 멀티스레드 작업에는 CompletableFuture가 유용하다.
- 하지만 다음 사항을 반드시 지켜야 한다:

1. `CompletableFuture`를 사용할 때는 **반드시 별도의 스레드 풀을 지정**할 것.
2. 그렇지 않으면 내부적으로 Fork/Join 공용 풀이 사용되어 병렬 스트림과 동일한 문제를 일으킬 수 있다.

```java
// 잘못된 사용 - 공용 풀 사용
CompletableFuture.runAsync(() -> doSomething());

// 올바른 사용 - ExecutorService 지정
ExecutorService executor = Executors.newFixedThreadPool(10);
CompletableFuture.runAsync(() -> doSomething(), executor);
```

### 그 외 추가적인 팁

- Future, CompletableFuture, 스레드 풀, 람다, 스트림을 학습해두면 멀티스레드 기반의 비동기 프로그래밍에 큰 도움이 된다.

- CompletableFuture는 실무에서 자주 사용되므로, 필요할 때 찾아서 익히는 방식으로 충분히 활용할 수 있다.

### 결론
- **CompletableFuture를 사용할 때는 반드시 별도의 스레드 풀을 지정하자.**
- **Fork/Join 공용 풀을 공유하지 말자.**
- Fork/Join 공용 풀은 JVM 전체에서 공유되므로, I/O 바운드 작업 등에 함부로 사용하지 말고, 필요한 경우 별도 스레드 풀을 지정하자는 뜻

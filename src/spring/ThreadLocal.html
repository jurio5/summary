
### ThreadLocal 이란?

- 쓰레드 로컬은 해당 쓰레드만 접근할 수 있는 특별한 저장소를 말한다.
- 쓰레드 로컬을 사용하면 각 쓰레드마다 별도의 내부 저장소를 제공한다. 따라서 같은 인스턴스 쓰레드 로컬 필드에 접근해도 문제 없다.
- 자바는 언어차원에서 쓰레드 로컬을 지원하기 위한 `ThreadLocal`클래스를 제공한다.

## ThreadLocal 사용법

```java
private ThreadLocal<String> nameStore = new ThreadLocal<>();

  public String logic(String name) {
  log.info("저장 name={} -> nameStore={}", name, nameStore.get());
  nameStore.set(name);
  sleep(1000);
  log.info("조회 nameStore={}", nameStore.get());
  return nameStore.get();
  }
  ```

  - 값 저장 : `ThreadLocal.set(xxx)`
  - 값 조회 : `ThreadLocal.get()`
  - 값 제거 : `ThreadLocal.remove()`
  - `remove`의 경우 만약, `ThreadC`에서 `remove`가 호출이 되면, `ThreadC`의 쓰레드 로컬 저장소만 제거되는 방식

  ### ThreadLocal 주의사항

  - 쓰레드 로컬 값을 사용 후 제거하지 않고 그냥 두면 WAS(톰캣) 처럼 쓰레드 풀을 사용하는 경우에 심각한 문제가 발생할 수 있다.

  ![[쓰레드 로컬 저장.png]]

  ![[쓰레드 로컬 종료.png]]![[쓰레드 로컬 조회.png]]